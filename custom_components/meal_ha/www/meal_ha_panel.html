<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<title>Meal HA - Gestion des ingrédients</title>
		<style>
			body {
				font-family: sans-serif;
				margin: 2em;
			}
			input,
			button {
				font-size: 1em;
				margin: 0.5em;
			}
			ul {
				margin-top: 1em;
			}
		</style>
	</head>
	<body>
		<h2>Ajouter un ingrédient</h2>
		<input id="ingredient" placeholder="Nom de l'ingrédient" />
		<button onclick="addIngredient()">Ajouter</button>
		<h3>Liste des ingrédients</h3>
		<ul id="ingredients-list"></ul>
		<script>
			async function fetchIngredients() {
				// Appel à l'API REST Home Assistant pour récupérer la liste
				const resp = await fetch("/api/states/sensor.liste_des_ingredients", {
					credentials: "same-origin",
				});
				if (!resp.ok) return;
				const data = await resp.json();
				const ingredients = data.attributes.ingredients || {};
				const ul = document.getElementById("ingredients-list");
				ul.innerHTML = "";
				Object.values(ingredients).forEach((name) => {
					const li = document.createElement("li");
					li.textContent = name;
					ul.appendChild(li);
				});
			}
			async function addIngredient() {
				const name = document.getElementById("ingredient").value;
				if (!name) return;
				await fetch("/api/services/meal_ha/add_food", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ name }),
				});
				document.getElementById("ingredient").value = "";
				setTimeout(fetchIngredients, 500);
			}
			fetchIngredients();
		</script>
	</body>
</html>
